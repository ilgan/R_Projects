---
title: "hw10"
author: "iganelin"
date: "December 1, 2017"
output: html_document
---
## HW10


#### We start with loading all the necessary general purpose libraries

```{r message=FALSE}
library(tidyverse)
library(magrittr)
library(purrr)
library(glue)
library(stringr)
library(purrr)
library(ggmap)
```

#### Libraries for web scraping

```{r message=FALSE}
library(rvest)
library(xml2)
library(httr)
library(leaflet)
```
#### Working with the [OMDB API](https://www.omdbapi.com)

```{r message=FALSE}
get_movie <- function(title, year, key){
	query_string <- glue("http://www.omdbapi.com/?t={title}&y={year}&apikey={key}")
	movie_result <- httr::GET(query_string)
	movie_content <- as.data.frame(content(movie_result))
	return(movie_content)
}
```

##### Start with requesting the information of one of the movies you would like to see. For testing purposes only use your key. you can request it [here](https://www.omdbapi.com/apikey.aspx).

```{r message=FALSE}
movie_info <- get_movie("babe", "1995","33ffee5e")
typeof(movie_info)
View(movie_info)
```

##### Let's plot the Movie's of interest Location using ggmap and leaflet.

```{r}
get_movie_location <- function(movie_info){
	countries <- str_split(movie_info$Country, ",")
	loc <- geocode(as.character(countries))
	m <- leaflet() %>%
  		addTiles() %>%  # Add default OpenStreetMap map tiles
  		addMarkers(lng=loc$lon, lat=loc$lat, popup="Movie Location")
	return(m)
}

map <- get_movie_location(movie_info)
map

```

##### Let's expand our function to output multiple

```{r message=FALSE}
get_movies <- function(title, key){
	for (i in 1:length(movies_list)){
		if (i == 1){
			query_string <- glue("http://www.omdbapi.com/?t={movies_list[i]}&apikey={key}")
			movie_result <- httr::GET(query_string)
			movie_content <- as.data.frame(content(movie_result))
		}
		else{
			query_string <- glue("http://www.omdbapi.com/?t={movies_list[i]}&apikey={key}")
			movie_result <- httr::GET(query_string)
			movie_content <- full_join(movie_content, as.data.frame(content(movie_result)), by = colnames(as.data.frame(content(movie_result))))
		}
	}
	return(movie_content)
}
```

#### Let's see the result.
We start with creating a list of the movies we would like to download info for.

```{r message=FALSE}
movies_list <- c("babe", "thor", "spiderman")
movies <- get_movies(movies_list, "33ffee5e")
View(movies)
```
So now we can download the movie info and save it into the dataframe that we can use later in the project.

#### Lets download the movie information from another [source](https://www.theimdbapi.org/) 
```{r message=FALSE}
get_movie2 <- function(title, year){
	query_string <- glue("http://www.theimdbapi.org/api/find/movie?title={title}&year={year}")
	movie_result <- httr::GET(query_string)
	movie_content <- as.data.frame(content(movie_result)[[1]])
	return(movie_content)
}
```

#### Lets download the movie information from yet another [source](https://www.themoviedb.org) 
```{r message=FALSE}
get_movie3 <- function(title, year){
	query_string <- glue("https://api.themoviedb.org/3/movie/550?api_key=ae1992621fc683b8b15c4a9bef59b8bb")
	movie_result <- httr::GET(query_string)
	movie_content <- as.data.frame(content(movie_result))
	return(movie_content)
}
```

##### Start with requesting the information of one of the movies you would like to see from [here](https://www.theimdbapi.org/).

```{r message=FALSE}
col_names <- colnames(movies)
movie_info2 <- get_movie2("transformers", "2007")
View(movie_info2)

query_string <- glue("https://api.themoviedb.org/3/search/movie?api_key=ae1992621fc683b8b15c4a9bef59b8bb&query=Jack+Reacher")
movie_result <- httr::GET(query_string)
movie_content <- as.data.frame(content(movie_result))
View(content(movie_result))
	
ae1992621fc683b8b15c4a9bef59b8bb

query_string <- glue("http://www.theimdbapi.org/api/find/movie?title=transformers&year=2007")

query_string <- glue("http://www.theimdbapi.org/api/find/movie?title=transformers&year=2007")
movie_result <- httr::GET(query_string)
movie_content <- as.data.frame(content(movie_result)[[1]])
	
typeof(movie_info2)
View(content(movie_result)[[1]])

full_join(movie_content, as.data.frame(content(movie_result)), by = colnames(as.data.frame(content(movie_result))))
content(movie_result)[[1]]
```
